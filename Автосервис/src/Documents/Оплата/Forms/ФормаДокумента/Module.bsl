
&НаСервере
Функция ПолучитьСуммуКОплате(ЗаказНарядСсылка)
	ЗаказНаряд = ЗаказНарядСсылка.ПолучитьОбъект();
	СуммаКОплате = 0;
	Для Каждого СтрокаРаботы Из ЗаказНаряд.Работы Цикл
		СуммаКОплате = СуммаКОплате + СтрокаРаботы.ИтогСумма;
	КонецЦикла;
	Возврат СуммаКОплате;
КонецФункции

&НаКлиенте
Процедура ЗаказНарядПриИзменении(Элемент)
	ЗаказНаряд = Объект.ЗаказНаряд;
	Если ЗаказНаряд = Неопределено Тогда
		Объект.СуммаКОплате = 0;
	Иначе
		Объект.СуммаКОплате = ПолучитьСуммуКОплате(ЗаказНаряд);
	КонецЕсли;
		
КонецПроцедуры

&НаСервере
Процедура ПечатьЧекаНаСервере(ТабДок)
	Макет = Документы.Оплата.ПолучитьМакет("Макет");
	Шапка = Макет.ПолучитьОбласть("Шапка");
	ТабДок.Очистить();
	ИмяКассира = Объект.Кассир.Фамилия + " " + Объект.Кассир.Имя + " " + Объект.Кассир.Отчество;
	Если НЕ ЗначениеЗаполнено(Объект.Номер) Тогда
		Номер = "Документ не проведен. Неопределено";
	Иначе
	    Номер = Объект.Номер;
	КонецЕсли;
	Шапка.Параметры.ИмяКассира = ИмяКассира;
	Шапка.Параметры.НомерЧека = Номер;
	ТабДок.Вывести(Шапка);
	ШапкаТаблицы = Макет.ПолучитьОбласть("ШапкаТаблицы");
	ТабДок.Вывести(ШапкаТаблицы);
	СтрокаТаблицы = Макет.ПолучитьОбласть("СтрокаТаблицы");
	СуммаКОплате = Объект.СуммаКОплате;
	СтоимостьНормаЧаса = РегистрыСведений.СтоимостьНормаЧаса.ПолучитьПоследнее(Объект.ЗаказНаряд.Дата);
	
	Для Каждого СтрокаРаботы Из Объект.ЗаказНаряд.Работы Цикл
		СтрокаТаблицы.Параметры.НазваниеТовараРаботы = СтрокаРаботы.Работа.Наименование;
		СтрокаТаблицы.Параметры.Цена = СтрокаРаботы.Работа.НормаЧас * СтоимостьНормаЧаса.Стоимость;
		СтрокаТаблицы.Параметры.Количество = СтрокаРаботы.Количество;
		СтрокаТаблицы.Параметры.Сумма = СтрокаРаботы.Сумма;
		ТабДок.Вывести(СтрокаТаблицы);
		Для Каждого СтрокаДетали Из Объект.ЗаказНаряд.Автодетали Цикл
			Если СтрокаДетали.СсылкаНаРаботу = СтрокаРаботы.Работа Тогда
				Если СтрокаДетали.ДетальКлиента Тогда
					СтрокаТаблицы.Параметры.НазваниеТовараРаботы = 
						СтрокаДетали.Материал.Наименование + " " + "(деталь клиента)";
				Иначе
					СтрокаТаблицы.Параметры.НазваниеТовараРаботы = 
						СтрокаДетали.Материал.Наименование;
				КонецЕсли;
				СтрокаТаблицы.Параметры.Цена = СтрокаДетали.Цена;
				СтрокаТаблицы.Параметры.Количество = СтрокаДетали.Количество;
				СтрокаТаблицы.Параметры.Сумма = СтрокаДетали.Сумма;
				ТабДок.Вывести(СтрокаТаблицы);
			КонецЕсли;
		КонецЦикла;
	КонецЦикла;
	Итого = Макет.ПолучитьОбласть("Итого");
	Итого.Параметры.СуммаИтог = СуммаКОплате;
	ТабДок.Вывести(Итого);
	
КонецПроцедуры

&НаКлиенте
Процедура ПечатьЧека(Команда)
	ТабДок = Новый ТабличныйДокумент;
	ПечатьЧекаНаСервере(ТабДок);
	ТабДок.Показать();
КонецПроцедуры

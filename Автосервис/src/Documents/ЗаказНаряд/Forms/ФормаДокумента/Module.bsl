


&НаСервере
Процедура ПечатьЧекаНаСервере(ТабДок)
    //
    Макет = Документы.ЗаказНаряд.ПолучитьМакет("МакетЗаказНаряда");
    
    // 
    
    
    // 
    ОбластьСертификат = Макет.ПолучитьОбласть("Шапка");
    ТабДок.Очистить();
    // 
    
    ИмяКлиента = Объект.Клиент.ФИОКонтактногоЛица;
	Дата = Объект.Дата;
	Автомобиль = Объект.Автомобиль.Наименование;
	
	
    ОбластьСертификат.Параметры.ИмяПоставщика = "ООО 'Без колес'";
//    ОбластьСертификат.Параметры.ИНН = "7710047278";
//    ОбластьСертификат.Параметры.КПП = "771001001";
//    ОбластьСертификат.Параметры.Адрес = "414052, Астраханская обл., Астрахань г., Ленина б-р, дом № 78, кв.1";
//    ОбластьСертификат.Параметры.Телефон = "936-16-36";
    
    ТабДок.Вывести(ОбластьСертификат);
    
    
    ШапкаТаблицы = Макет.ПолучитьОбласть("ШапкаТаблицы");
	ТабДок.Вывести(ШапкаТаблицы);
	
	
	
    ОбластьЗаголовок = Макет.ПолучитьОбласть("Заголовок");
    
    ОбластьЗаголовок.Параметры.НомерНаряда = Объект.Номер;
    ОбластьЗаголовок.Параметры.ДатаНаряда = Формат(Объект.Дата, "ДЛФ='dd MMMM yyyy г.'");
    
    ТабДок.Вывести(ОбластьЗаголовок);
    
    //
    ОбластьКлиентАвто = Макет.ПолучитьОбласть("КлиентАвто");
    
    //
    Если ЗначениеЗаполнено(Объект.Клиент) Тогда
        ОбластьКлиентАвто.Параметры.ИмяЗаказчика = Объект.Клиент.Наименование;
        ОбластьКлиентАвто.Параметры.АдресЗаказчика = Объект.Клиент.АдресПроживания; // или АдресПрописки
        ОбластьКлиентАвто.Параметры.ТелефоныЗаказчика = Объект.Клиент.Телефон;
    КонецЕсли;
    
    // 
    Если ЗначениеЗаполнено(Объект.Автомобиль) Тогда
        ОбластьКлиентАвто.Параметры.АвтомобильЗаказчика = Объект.Автомобиль.Марка + " " + Объект.Автомобиль.Модель;
        ОбластьКлиентАвто.Параметры.НомерАвтомобиляЗаказчика = Объект.Автомобиль.Госномер;
        ОбластьКлиентАвто.Параметры.НомерВИН = Объект.Автомобиль.НомерVIN;
        ОбластьКлиентАвто.Параметры.ГодВыпуска = Объект.Автомобиль.ДатаВыпуска;
        ОбластьКлиентАвто.Параметры.ПробегАвтомобиля = Объект.Автомобиль.Пробег + " км";
    КонецЕсли;
    
    ТабДок.Вывести(ОбластьКлиентАвто);
    
    // 
    ОбластьПриемка = Макет.ПолучитьОбласть("Приемка");
    
    ОбластьПриемка.Параметры.ДатаПриемки = Формат(Объект.Дата, "ДЛФ='dd.MM.yyyy'");
    
    Если ЗначениеЗаполнено(Объект.МастерПриемщик) Тогда
        ОбластьПриемка.Параметры.МастерПриемщик = Объект.МастерПриемщик.ФИО;
    КонецЕсли;
    
    ТабДок.Вывести(ОбластьПриемка);
    
    //
    ОбластьЗаголовокРабот = Макет.ПолучитьОбласть("ЗаголовокРабот");
    ТабДок.Вывести(ОбластьЗаголовокРабот);
    
    ОбластьШапкаТаблицыРабот = Макет.ПолучитьОбласть("ШапкаТаблицыРабот");
    ТабДок.Вывести(ОбластьШапкаТаблицыРабот);
    
    ОбластьСтрокаРаботы = Макет.ПолучитьОбласть("СтрокаРаботы");
    ОбщаяСуммаРабот = 0;
    
    // 
    СтоимостьНормаЧаса = РегистрыСведений.СтоимостьНормаЧаса.ПолучитьПоследнее(Объект.Дата);
    
    //
    НомерСтроки = 1;
    Для Каждого СтрокаРаботы Из Объект.Работы Цикл
        ОбластьСтрокаРаботы.Параметры.Номер = НомерСтроки;
        ОбластьСтрокаРаботы.Параметры.НаименованиеРабот = СтрокаРаботы.Работа.Наименование;
        ОбластьСтрокаРаботы.Параметры.Количество = СтрокаРаботы.Количество;
        ОбластьСтрокаРаботы.Параметры.НормаЧасов = СтрокаРаботы.НормаЧас;
        ОбластьСтрокаРаботы.Параметры.ЦенаНормаЧаса = СтоимостьНормаЧаса.Стоимость;
        
        //
        СуммаРаботы = СтрокаРаботы.НормаЧас * СтрокаРаботы.Количество * СтоимостьНормаЧаса.Стоимость;
        ОбластьСтрокаРаботы.Параметры.Сумма = СуммаРаботы;
        ОбщаяСуммаРабот = ОбщаяСуммаРабот + СуммаРаботы;
        
        ТабДок.Вывести(ОбластьСтрокаРаботы);
        НомерСтроки = НомерСтроки + 1;
    КонецЦикла;
    
    // 
    ОбластьИтогоРабот = Макет.ПолучитьОбласть("ИтогоРабот");
    ОбластьИтогоРабот.Параметры.СуммаРабот = ОбщаяСуммаРабот;
    ТабДок.Вывести(ОбластьИтогоРабот);
    
    // 
    ОбластьЗаголовокМатериалов = Макет.ПолучитьОбласть("ЗаголовокМатериалов");
    ТабДок.Вывести(ОбластьЗаголовокМатериалов);
    
    ОбластьШапкаТаблицыМатериалов = Макет.ПолучитьОбласть("ШапкаТаблицыМатериалов");
    ТабДок.Вывести(ОбластьШапкаТаблицыМатериалов);
    
    ОбластьСтрокаМатериалов = Макет.ПолучитьОбласть("СтрокаМатериалов");
    ОбщаяСуммаМатериалов = 0;
    
    // 
    НомерСтроки = 1;
    Для Каждого СтрокаМатериала Из Объект.Автодетали Цикл
        Если НЕ СтрокаМатериала.ДетальКлиента Тогда
            ОбластьСтрокаМатериалов.Параметры.Номер = НомерСтроки;
            ОбластьСтрокаМатериалов.Параметры.НаименованиеТовара = СтрокаМатериала.Материал.Наименование;
            ОбластьСтрокаМатериалов.Параметры.Количество = СтрокаМатериала.Количество;
            ОбластьСтрокаМатериалов.Параметры.Цена = СтрокаМатериала.Цена;
            ОбластьСтрокаМатериалов.Параметры.Сумма = СтрокаМатериала.Сумма;
            
            ОбщаяСуммаМатериалов = ОбщаяСуммаМатериалов + СтрокаМатериала.Сумма;
            
            ТабДок.Вывести(ОбластьСтрокаМатериалов);
            НомерСтроки = НомерСтроки + 1;
        КонецЕсли;
    КонецЦикла;
    
    // 
    ОбластьИтогоМатериалов = Макет.ПолучитьОбласть("ИтогоМатериалов");
    ОбластьИтогоМатериалов.Параметры.СуммаМатериалов = ОбщаяСуммаМатериалов;
    ТабДок.Вывести(ОбластьИтогоМатериалов);
    
    // 
    ОбластьОбщаяСумма = Макет.ПолучитьОбласть("ОбщаяСумма");
    
    ОбщаяСумма = ОбщаяСуммаРабот + ОбщаяСуммаМатериалов;
    ОбластьОбщаяСумма.Параметры.СуммаЦифрами = ОбщаяСумма;
    
    ТабДок.Вывести(ОбластьОбщаяСумма);
    
    // 
    ОбластьПодписи = Макет.ПолучитьОбласть("Подписи");
    ТабДок.Вывести(ОбластьПодписи);
    
КонецПроцедуры

&НаКлиенте
Процедура ПечатьЧека(Команда)
	ТабДок = Новый ТабличныйДокумент();
	ПечатьЧекаНаСервере(ТабДок);
	ТабДок.Показать();
КонецПроцедуры








&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	// Устанавливаем дату документа на текущую дату
	Объект.Дата = ТекущаяДата();
	
	// Устанавливаем статус по умолчанию - "Приемка"
	Если Объект.Статус = Неопределено Или Объект.Статус.Пустая() Тогда
		Объект.Статус = Перечисления.СтатусЗаказНаряда.Приемка;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	// 
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьДанные(Команда)
	
	// 
	Если Объект.Клиент = Неопределено Или Объект.Клиент.Пустая() Тогда
		Сообщить("Необходимо указать клиента!");
		Возврат;
	КонецЕсли;
	
	Если Объект.Автомобиль = Неопределено Или Объект.Автомобиль.Пустая() Тогда
		Сообщить("Необходимо указать автомобиль!");
		Возврат;
	КонецЕсли;
	
    МассивЗаписей = НайтиЗаписиКлиентаНаСегодняНаСервере(Объект.Клиент, Объект.Автомобиль);
    
    Если МассивЗаписей.Количество() = 0 Тогда
        Сообщить("На сегодня нет записей для этого клиента и автомобиля.");
        Возврат;
    КонецЕсли;
    
    Если МассивЗаписей.Количество() > 0 Тогда
        Сообщить("Найдено несколько записей.");
    КонецЕсли;
    
	ЗаполнитьДанныеИзЗаписи(МассивЗаписей);
	
	
	
КонецПроцедуры


&НаКлиенте
Процедура ЗаполнитьДанныеИзЗаписи(МассивЗаписей)
	
	Для Каждого ЭлементЗаписей из МассивЗаписей Цикл
		ИмяВарианта = Строка(ЭлементЗаписей.ВариантКалькуляции);
		
	КонецЦикла;
	
КонецПроцедуры

&НаСервере
Функция НайтиЗаписиКлиентаНаСегодняНаСервере(Клиент, Автомобиль)
    
    МассивЗаписей = Новый Массив;
    
    Запрос = Новый Запрос;
    Запрос.Текст = 
    "ВЫБРАТЬ
    |    ЗаписьВСервис.Ссылка КАК Ссылка,
    |    ЗаписьВСервис.Дата,
    |    ЗаписьВСервис.Автомобиль,
    |    ЗаписьВСервис.ПричинаОбращения,
    |    ЗаписьВСервис.Калькуляция,
    |    ЗаписьВСервис.ВариантКалькуляции
    |ИЗ
    |    Документ.ЗаписьВСервис КАК ЗаписьВСервис
    |ГДЕ
    |    ЗаписьВСервис.Клиент = &Клиент
    |    И ЗаписьВСервис.Дата >= &НачалоДня
    |    И ЗаписьВСервис.Дата <= &КонецДня
    |    И ЗаписьВСервис.Автомобиль = &Автомобиль";
    
    
    Запрос.Текст = Запрос.Текст + " УПОРЯДОЧИТЬ ПО ЗаписьВСервис.Дата";
    
    Запрос.УстановитьПараметр("Клиент", Клиент);
    Запрос.УстановитьПараметр("НачалоДня", НачалоДня(ТекущаяДата()));
    Запрос.УстановитьПараметр("КонецДня", КонецДня(ТекущаяДата()));
    Запрос.УстановитьПараметр("Автомобиль", Автомобиль);
    
    Результат = Запрос.Выполнить();
    Выборка = Результат.Выбрать();
    
    Пока Выборка.Следующий() Цикл
        СтруктураЗаписи = Новый Структура;
        СтруктураЗаписи.Вставить("Ссылка", Выборка.Ссылка);
        СтруктураЗаписи.Вставить("Дата", Выборка.Дата);
        СтруктураЗаписи.Вставить("Автомобиль", Выборка.Автомобиль);
        СтруктураЗаписи.Вставить("ПричинаОбращения", Выборка.ПричинаОбращения);
        СтруктураЗаписи.Вставить("Калькуляция", Выборка.Калькуляция);
        СтруктураЗаписи.Вставить("ВариантКалькуляции", Выборка.ВариантКалькуляции);
        МассивЗаписей.Добавить(СтруктураЗаписи);
    КонецЦикла;
    
    Возврат МассивЗаписей;
    
КонецФункции

//&НаСервере
//Процедура ЗаполнитьДанныеНаСервере()
//	
//	// ываываываыва
//	// 
//	Запрос = Новый Запрос;
//	Запрос.Текст = "ВЫБРАТЬ ПЕРВЫЕ 1
//	|	Калькуляция.Ссылка КАК Ссылка
//	|ИЗ
//	|	Документ.Калькуляция КАК Калькуляция
//	|ГДЕ
//	|	Калькуляция.Клиент = &Клиент
//	|	И Калькуляция.Автомобиль = &Автомобиль
//	|	И Калькуляция.Проведен = ИСТИНА
//	|
//	|УПОРЯДОЧИТЬ ПО
//	|	Калькуляция.Дата УБЫВ
//	|	, Калькуляция.МоментВремени УБЫВ";
//	
//	Запрос.УстановитьПараметр("Клиент", Объект.Клиент);
//	Запрос.УстановитьПараметр("Автомобиль", Объект.Автомобиль);
//	
//	РезультатЗапроса = Запрос.Выполнить();
//	Выборка = РезультатЗапроса.Выбрать();
//	
//	Если Выборка.Следующий() Тогда
//		// 
//		Объект.Калькуляция = Выборка.Ссылка;
//		ЗаполнитьИзКалькуляцииНаСервере();
//	Иначе
//		// 
//		Сообщить("Калькуляция для данного клиента и автомобиля не найдена. Заполните данные вручную или создайте калькуляцию.");
//	КонецЕсли;
//	
//КонецПроцедуры

&НаКлиенте
Процедура КлиентПриИзменении(Элемент)
	
	// 
	//
	
КонецПроцедуры

&НаКлиенте
Процедура СтатусПриИзменении(Элемент)
	
	// 
	Если Объект.Статус = Неопределено Или Объект.Статус.Пустая() Тогда
		Возврат;
	КонецЕсли;
	
	//
	// 
	
КонецПроцедуры

//&НаКлиенте
//Процедура КалькуляцияПриИзменении(Элемент)
//	
//	// 
//	Если Объект.Калькуляция <> Неопределено И Не Объект.Калькуляция.Пустая() Тогда
//		ЗаполнитьИзКалькуляцииНаСервере();
//	КонецЕсли;
//	
//КонецПроцедуры

//&НаСервере
//Процедура ЗаполнитьИзКалькуляцииНаСервере()
//	
//	// 
//	Если Объект.Калькуляция = Неопределено Или Объект.Калькуляция.Пустая() Тогда
//		Возврат;
//	КонецЕсли;
//	
//	ДокументКалькуляция = Объект.Калькуляция.ПолучитьОбъект();
//	
//	//
//	Объект.Работы.Очистить();
//	Для Каждого СтрокаРаботы Из ДокументКалькуляция.Работы Цикл
//		НоваяСтрокаРаботы = Объект.Работы.Добавить();
//		НоваяСтрокаРаботы.Работа = СтрокаРаботы.Работа;
//		НоваяСтрокаРаботы.Количество = СтрокаРаботы.Количество;
//		НоваяСтрокаРаботы.НормаЧас = СтрокаРаботы.НормаЧас;
//		НоваяСтрокаРаботы.Сумма = СтрокаРаботы.НормаЧас * СтрокаРаботы.Количество;
//	КонецЦикла;
//	
//	// 
//	Объект.Автодетали.Очистить();
//	Для Каждого СтрокаДетали Из ДокументКалькуляция.Автодетали Цикл
//		НоваяСтрокаДетали = Объект.Автодетали.Добавить();
//		НоваяСтрокаДетали.Автодеталь = СтрокаДетали.Автодеталь;
//		НоваяСтрокаДетали.Количество = СтрокаДетали.Количество;
//		// 
//		НоваяСтрокаДетали.ДетальКлиента = Ложь;
//	КонецЦикла;
//	
//КонецПроцедуры



&НаСервере
Функция ПолучитьНормаЧасРаботы(Работа)
	
	Если Работа = Неопределено Или Работа.Пустая() Тогда
		Возврат 0;
	КонецЕсли;
	
	Попытка
		РаботаОбъект = Работа.ПолучитьОбъект();
		Если РаботаОбъект.Свойство("НормаЧас") Тогда
			Возврат РаботаОбъект.НормаЧас;
		Иначе
			Возврат 0;
		КонецЕсли;
	Исключение
		Возврат 0;
	КонецПопытки;
	
КонецФункции

&НаКлиенте
Функция ПолучитьНормаЧасРаботыНаСервере(Работа)
	
	Возврат ПолучитьНормаЧасРаботы(Работа);
	
КонецФункции



//&НаСервере
//Функция РассчитатьНормаЧасы(Работа, Количество)
//	РаботаОбъект = Работа.ПолучитьОбъект();
//	Возврат РаботаОбъект.НормаЧас * Количество
//КонецФункции

&НаКлиенте
Процедура ПересчитатьСуммуРаботы(СтрокаРаботы)
	
	Если СтрокаРаботы = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	// 
	СтрокаРаботы.Сумма = СтрокаРаботы.НормаЧас * СтрокаРаботы.Количество;
	
КонецПроцедуры





//&НаКлиенте
//Процедура АвтодеталиРаботыМатериалПриИзменении(Элемент)
//	
//	// 
////	СтрокаДетали = Элементы.Автодетали.ТекущиеДанные;
////	Если СтрокаДетали = Неопределено Тогда
////		Возврат;
////	КонецЕсли;
////	
////	// 
////	Если СтрокаДетали.ДетальКлиента Тогда
////		СтрокаДетали.Цена = 0;
////		СтрокаДетали.Сумма = 0;
////		Возврат;
////	КонецЕсли;
////	
////	Если СтрокаДетали.Материал <> Неопределено И Не СтрокаДетали.Материал.Пустая() Тогда
////		// 
////		Цена = ПолучитьЦену(СтрокаДетали.Материал);
////		Если Цена > 0 Тогда
////			СтрокаДетали.Цена = Цена;
////			ПересчитатьСуммуДетали(СтрокаДетали);
////		Иначе
////			СтрокаДетали.Цена = 0;
////			СтрокаДетали.Сумма = 0;
////		КонецЕсли;
////	КонецЕсли;
//
//	Сообщить("Произошло изменение ");
//
//	Материал = Элементы.Автодетали.ТекущиеДанные.АвтодеталиМатериал;
//	Количество = Элементы.Автодетали.ТекущиеДанные.АвтодеталиыКоличество;
//	Цена = ПолучитьЦену(Материал);
//	ДетальКлиента = Элементы.Автодетали.ТекущиеДанные.ДетальКлиента;
//	Если Не ДетальКлиента Тогда
//		Элементы.Автодетали.ТекущиеДанные.АвтодеталиЦена = Цена;
//		Элементы.Автодетали.ТекущиеДанные.АвтодеталиСумма = Цена*Количество;
//	КонецЕсли;
//	
//	
//	
//КонецПроцедуры

&НаСервере
Функция ПолучитьЦенуМатериала(Материал)
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	|	СтоимостьМатериалов.Материал,
	|	СтоимостьМатериалов.Стоимость
	|ИЗ
	|	РегистрСведений.СтоимостьМатериалов КАК СтоимостьМатериалов
	|ГДЕ
    |   СтоимостьМатериалов.Материал = &Материал";
    Запрос.УстановитьПараметр(
        "Материал", Материал    
    );
    РезультатЗапроса = Запрос.Выполнить();
    Записи = РезультатЗапроса.Выбрать();
    Пока Записи.Следующий() Цикл
        Возврат Записи.Стоимость;
    КонецЦикла;
КонецФункции





&НаКлиенте
Функция ПолучитьЦену(Материал)
	
	Возврат ПолучитьЦенуМатериала(Материал);
	
КонецФункции

&НаКлиенте
Процедура АвтодеталиКоличествоПриИзменении(Элемент)
	
	// 
//	СтрокаДетали = Элементы.Автодетали.ТекущиеДанные;
//	Если СтрокаДетали <> Неопределено Тогда
//		// 
//		Если СтрокаДетали.ДетальКлиента Тогда
//			СтрокаДетали.Сумма = 0;
//		Иначе
//			ПересчитатьСуммуДетали(СтрокаДетали);
//		КонецЕсли;
//	КонецЕсли;
	Сообщить("Произошло изменение ");

	Материал = Элементы.Автодетали.ТекущиеДанные.Материал;
	Количество = Элементы.Автодетали.ТекущиеДанные.Количество;
	Цена = ПолучитьЦену(Материал);
//	Элементы.Автодетали.ТекущиеДанные.Цена = Цена;
//	Элементы.Автодетали.ТекущиеДанные.Сумма = Цена*Количество;
	ДетальКлиента = Элементы.Автодетали.ТекущиеДанные.ДетальКлиента;
	Если Не ДетальКлиента Тогда
		Элементы.Автодетали.ТекущиеДанные.Цена = Цена;
		Элементы.Автодетали.ТекущиеДанные.Сумма = Цена*Количество;
	Иначе
		Элементы.Автодетали.ТекущиеДанные.Цена = 0;
		Элементы.Автодетали.ТекущиеДанные.Сумма = 0;
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Функция РассчитатьНормаЧасы(Работа, Количество)
	РаботаОбъект = Работа.ПолучитьОбъект();
	Возврат РаботаОбъект.НормаЧас * Количество
КонецФункции

&НаСервере
Функция РассчитатьСтоимостьНормаЧасы()
	Запись = РегистрыСведений.СтоимостьНормаЧаса.ПолучитьПоследнее(Объект.Дата);
	Если Запись = Неопределено Тогда
        // Если запись не найдена, вернуть 0 или значение по умолчанию
        Возврат 0;
    КонецЕсли;
    
    // Возвращаем только значение ресурса "Стоимость"
    Возврат Запись.Стоимость;
КонецФункции

&НаКлиенте
Процедура РаботыКоличествоПриИзменении(Элемент)
	
	// 
//	СтрокаТабличнойЧасти = Элементы.Работы.ТекущиеДанные;
//	СтрокаТабличнойЧасти.НормаЧас = РассчитатьНормаЧасы(СтрокаТабличнойЧасти.Работа, СтрокаТабличнойЧасти.Количество);
//    НовыеДетали = ПолучитьДеталиРаботыСУчетомКоличество(
//        СтрокаТабличнойЧасти.Работа,
//        СтрокаТабличнойЧасти.Количество
//    );

	Работа = Элементы.Работы.ТекущиеДанные.Работа;
	Количество = Элементы.Работы.ТекущиеДанные.Количество;
	
	Нормачасы = РассчитатьНормаЧасы(Работа, Количество);
	
	Элементы.Работы.ТекущиеДанные.Нормачас = Нормачасы;
	
	СтоимостьНормаЧаса = РассчитатьСтоимостьНормаЧасы();
	
//	Сообщить(СтоимостьНормаЧаса + " ывпывап");
	
	Элементы.Работы.ТекущиеДанные.Сумма = Нормачасы * СтоимостьНормаЧаса;
	
	
	
КонецПроцедуры

&НаКлиенте
Процедура РаботыРаботаПриИзменении(Элемент)
	
	Работа = Элементы.Работы.ТекущиеДанные.Работа;
	Количество = Элементы.Работы.ТекущиеДанные.Количество;
	
	Нормачасы = РассчитатьНормаЧасы(Работа, Количество);
	
	Элементы.Работы.ТекущиеДанные.Нормачас = Нормачасы;
	
	СтоимостьНормаЧаса = РассчитатьСтоимостьНормаЧасы();
	
//	Сообщить(СтоимостьНормаЧаса + " ывпывап");
	
	Элементы.Работы.ТекущиеДанные.Сумма = Нормачасы * СтоимостьНормаЧаса;
	
КонецПроцедуры




&НаКлиенте
Процедура РаботыНормаЧасПриИзменении(Элемент)
	
	Работа = Элементы.Работы.ТекущиеДанные.Работа;
	Количество = Элементы.Работы.ТекущиеДанные.Количество;
	
	Нормачасы = Элементы.Работы.ТекущиеДанные.Нормачас;
//	
//	Нормачасы = Нормачасы * Количество;
	
	СтоимостьНормаЧаса = РассчитатьСтоимостьНормаЧасы();
	
//	Сообщить(СтоимостьНормаЧаса + " ывпывап");
	
	Элементы.Работы.ТекущиеДанные.Сумма = Нормачасы * СтоимостьНормаЧаса;
	
	//TODO: Вставить содержимое обработчика
КонецПроцедуры





&НаКлиенте
Процедура АвтодеталиДетальКлиентаПриИзменении(Элемент)
	
	// 
//	СтрокаДетали = Элементы.Автодетали.ТекущиеДанные;
//	Если СтрокаДетали = Неопределено Тогда
//		Возврат;
//	КонецЕсли;
	ДетальКлиента = Элементы.Автодетали.ТекущиеДанные.ДетальКлиента;
	Если Не ДетальКлиента Тогда
		Материал = Элементы.Автодетали.ТекущиеДанные.Материал;
		Количество = Элементы.Автодетали.ТекущиеДанные.Количество;
		Цена = ПолучитьЦену(Материал);
		Элементы.Автодетали.ТекущиеДанные.Цена = Цена;
		Элементы.Автодетали.ТекущиеДанные.Сумма = Цена*Количество;
	Иначе
		Элементы.Автодетали.ТекущиеДанные.Цена = 0;
		Элементы.Автодетали.ТекущиеДанные.Сумма = 0;
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура АвтодеталиАвтодетальПриИзменении(Элемент)
	
	// 
	
КонецПроцедуры

&НаКлиенте
Процедура АвтодеталиМатериалПриИзменении(Элемент)
	ДетальКлиента = Элементы.Автодетали.ТекущиеДанные.ДетальКлиента;
	Если Не ДетальКлиента Тогда
		Материал = Элементы.Автодетали.ТекущиеДанные.Материал;
		Количество = Элементы.Автодетали.ТекущиеДанные.Количество;
		Цена = ПолучитьЦену(Материал);
		Элементы.Автодетали.ТекущиеДанные.Цена = Цена;
		Элементы.Автодетали.ТекущиеДанные.Сумма = Цена*Количество;
	Иначе
		Элементы.Автодетали.ТекущиеДанные.Цена = 0;
		Элементы.Автодетали.ТекущиеДанные.Сумма = 0;
	КонецЕсли;
	//TODO: Вставить содержимое обработчика
КонецПроцедуры

//&НаКлиенте
//Процедура АвтодеталиЦенаПриИзменении(Элемент)
//	
//	// 
//	СтрокаДетали = Элементы.Автодетали.ТекущиеДанные;
//	Если СтрокаДетали <> Неопределено Тогда
//		//
//		Если СтрокаДетали.ДетальКлиента Тогда
//			СтрокаДетали.Сумма = 0;
//		Иначе
//			ПересчитатьСуммуДетали(СтрокаДетали);
//		КонецЕсли;
//	КонецЕсли;
//	
//КонецПроцедуры

&НаКлиенте
Процедура ПересчитатьСуммуДетали(СтрокаДетали)
	
	Если СтрокаДетали = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	//
	Если СтрокаДетали.ДетальКлиента Тогда
		СтрокаДетали.Сумма = 0;
		Возврат;
	КонецЕсли;
	
	// 
	СтрокаДетали.Сумма = СтрокаДетали.Цена * СтрокаДетали.Количество;
	
КонецПроцедуры
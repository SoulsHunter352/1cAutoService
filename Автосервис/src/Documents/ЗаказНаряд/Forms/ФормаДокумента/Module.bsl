
&НаСервере
Процедура ПечатьФормыНаСервере(ТабДок)
	Макет = Документы.ЗаказНаряд.ПолучитьМакет("НовыйМакет");
	ТабДок.Очистить();
	Шапка1 = Макет.ПолучитьОбласть("Шапка1");
	Если НЕ ЗначениеЗаполнено(Объект.Номер) Тогда
		Номер = "Документ не проведен. Неопределено";
	Иначе
		Номер = Объект.Номер;
	КонецЕсли;
	Шапка1.Параметры.Номер = Номер;
	Год = Формат(Объект.Дата, "ДФ=гггг");
	Месяц = Формат(Объект.Дата, "ДФ=ММММ");
	День = Формат(Объект.Дата, "ДФ=дд");
	Шапка1.Параметры.Год = Год;
	Шапка1.Параметры.Месяц = Месяц;
	Шапка1.Параметры.День = День;
	ТабДок.Вывести(Шапка1);
	ТаблицаНаряд = Макет.ПолучитьОбласть("ТаблицаНаряд");
	ТаблицаНаряд.Параметры.Автомобиль = Объект.Автомобиль.Наименование;
	ТаблицаНаряд.Параметры.Номер = Объект.Автомобиль.Госномер;
	ТаблицаНаряд.Параметры.VIN = Объект.Автомобиль.НомерVIN;
	ТаблицаНаряд.Параметры.Пробег = Объект.Автомобиль.Пробег;
	ТаблицаНаряд.Параметры.Год = Объект.Автомобиль.ДатаВыпуска;
	ТаблицаНаряд.Параметры.Заказчик = Объект.Клиент.Наименование;
	ТаблицаНаряд.Параметры.Адрес = Объект.Клиент.АдресПроживанияИлиФактическийАдрес;
	ТаблицаНаряд.Параметры.Телефон = Объект.Клиент.ТелефонКонтактногоЛица;
	ТабДок.Вывести(ТаблицаНаряд);
	Область2 = Макет.ПолучитьОбласть("Область2");
	Дата2 = Формат(Объект.Дата, "ДЛФ=Д");
	Область2.Параметры.Дата2 = Дата2;
	Область2.Параметры.Номер = Номер;
	ТабДок.Вывести(Область2);
	Шапка2 = Макет.ПолучитьОбласть("Шапка2");
	ТабДок.Вывести(Шапка2);
	ТаблицаСложная = Макет.ПолучитьОбласть("ТаблицаСложная");
	Номер2 = 1;
	ЦенаНЧ = РегистрыСведений.СтоимостьНормаЧаса.ПолучитьПоследнее(Объект.Дата).Стоимость;
	СуммаРабот = 0;
	Для Каждого СтрокаРабот Из Объект.Работы Цикл
		ТаблицаСложная.Параметры.Исполнитель = "Исполнитель " + СтрокаРабот.МастерПриемщик.Наименование;
		ТаблицаСложная.Параметры.Номер2 = Номер2;
		Номер2 = Номер2 + 1;
		ТаблицаСложная.Параметры.НаименованиеРабот = СтрокаРабот.Работа.Наименование;
		ТаблицаСложная.Параметры.Кол = СтрокаРабот.Количество;
		ТаблицаСложная.Параметры.Норма = СтрокаРабот.НормаЧас;
		ТаблицаСложная.Параметры.ЦенаНЧ = ЦенаНЧ;
		ТаблицаСложная.Параметры.Сумма = ЦенаНЧ*СтрокаРабот.НормаЧас*СтрокаРабот.Количество;
		СуммаРабот = СуммаРабот + ЦенаНЧ*СтрокаРабот.НормаЧас*СтрокаРабот.Количество;
		ТабДок.Вывести(ТаблицаСложная);
	КонецЦикла;
	Шапка3 = Макет.ПолучитьОбласть("Шапка3");
	Шапка3.Параметры.СуммаРабот = СуммаРабот;
	Шапка3.Параметры.Дата2 = Дата2;
	Шапка3.Параметры.Номер = Номер;
	ТабДок.Вывести(Шапка3);
	ТаблицаСложная2 = Макет.ПолучитьОбласть("ТаблицаСложная2");
	Номер3 = 1;
	ИтогСумма = 0;
	Для Каждого СтрокаМатериалы Из Объект.Автодетали Цикл
		ТаблицаСложная2.Параметры.Номер3 = Номер3;
		Номер3 = Номер3 +1;
		Наименование2 = СтрокаМатериалы.Материал.Наименование;
		ТаблицаСложная2.Параметры.Наименование2 = Наименование2;
		ТаблицаСложная2.Параметры.Кол2 = СтрокаМатериалы.Количество;
		ТаблицаСложная2.Параметры.Цена2 = СтрокаМатериалы.Цена;
		ТаблицаСложная2.Параметры.Сумма2 = СтрокаМатериалы.Количество * СтрокаМатериалы.Цена;
		ИтогСумма = ИтогСумма + СтрокаМатериалы.Количество * СтрокаМатериалы.Цена;
		ТабДок.Вывести(ТаблицаСложная2);
	КонецЦикла;
	ИтоговаяСумма = Макет.ПолучитьОбласть("ИтоговаяСумма");
	ИтоговаяСумма.Параметры.ИтогСумма = ИтогСумма;
	ТабДок.Вывести(ИтоговаяСумма);
КонецПроцедуры

&НаКлиенте
Процедура ПечатьФормы(Команда)
	ТабДок = Новый ТабличныйДокумент();
	ПечатьФормыНаСервере(ТабДок);
	ТабДок.Показать()
КонецПроцедуры
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	// Устанавливаем дату документа на текущую дату
	Объект.Дата = ТекущаяДата();
	
	// Устанавливаем статус по умолчанию - "Приемка"
	Если Объект.Статус = Неопределено Или Объект.Статус.Пустая() Тогда
		Объект.Статус = Перечисления.СтатусЗаказНаряда.Приемка;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	// 
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьДанные(Команда)
	
	// 
	Если Объект.Клиент = Неопределено Или Объект.Клиент.Пустая() Тогда
		Сообщить("Необходимо указать клиента!");
		Возврат;
	КонецЕсли;
	
	Если Объект.Автомобиль = Неопределено Или Объект.Автомобиль.Пустая() Тогда
		Сообщить("Необходимо указать автомобиль!");
		Возврат;
	КонецЕсли;
	
    МассивЗаписей = НайтиЗаписиКлиентаНаСегодняНаСервере(Объект.Клиент, Объект.Автомобиль);
    
    Если МассивЗаписей.Количество() = 0 Тогда
        Сообщить("На сегодня нет записей для этого клиента и автомобиля.");
        Возврат;
    КонецЕсли;
    
    Если МассивЗаписей.Количество() > 0 Тогда
        Сообщить("Найдено несколько записей.");
    КонецЕсли;
    
	ЗаполнитьДанныеИзЗаписи(МассивЗаписей);
	
	
	
КонецПроцедуры


&НаКлиенте
Процедура ЗаполнитьДанныеИзЗаписи(МассивЗаписей)
	
	Для Каждого ЭлементЗаписей из МассивЗаписей Цикл
		ИмяВарианта = Строка(ЭлементЗаписей.ВариантКалькуляции);
//		Сообщить("Имя варианта (строка): " + ИмяВарианта);
    
	    // Определяем номер варианта (1, 2 или 3)
	    НомерВарианта = 1; // По умолчанию
	    
	    Если ИмяВарианта = "Вариант1" Тогда
	        НомерВарианта = 1;
	    ИначеЕсли ИмяВарианта = "Вариант2" Тогда
	        НомерВарианта = 2;
	    ИначеЕсли ИмяВарианта = "Вариант3" Тогда
	        НомерВарианта = 3;
	    Иначе
	        Попытка
	            Если Найти(ИмяВарианта, "1") > 0 Тогда
	                НомерВарианта = 1;
	            ИначеЕсли Найти(ИмяВарианта, "2") > 0 Тогда
	                НомерВарианта = 2;
	            ИначеЕсли Найти(ИмяВарианта, "3") > 0 Тогда
	                НомерВарианта = 3;
	            КонецЕсли;
	        Исключение
	            НомерВарианта = 1;
	        КонецПопытки;
	    КонецЕсли;
	    
	    Сообщить("Используем вариант №" + НомерВарианта);
	    
	    
	    
	    // Берем первую запись (или любую другую)
    Запись = МассивЗаписей[0];
    
    // 1. Получаем ССЫЛКУ на документ "ЗаписьВСервис" из структуры
    СсылкаНаЗапись = Запись.Ссылка; // Это поле из вашего запроса
    
    // 2. Получаем ОБЪЕКТ документа по ссылке
    ДокументОбъект = СсылкаНаЗапись.ПолучитьОбъект();
    
    // 3. Теперь работаем с табличными частями объекта
    Сообщить("Обрабатываем запись от " + ДокументОбъект.Дата);
    
    // 4. Можем получить калькуляцию из записи
    Если ЗначениеЗаполнено(ДокументОбъект.Калькуляция) Тогда
        СсылкаНаКалькуляцию = ДокументОбъект.Калькуляция;
        
        // 5. Получаем объект калькуляции
        КалькуляцияОбъект = СсылкаНаКалькуляцию.ПолучитьОбъект();
        
        // 6. Теперь работаем как в вашем примере:
        Для Каждого СтрокаРаботы Из КалькуляцияОбъект.Работы Цикл
            Сообщить("Работа: " + СтрокаРаботы.Работа.Наименование + 
                     ", количество: " + СтрокаРаботы.Количество);
        КонецЦикла;
        
        // 7. Получаем вариант калькуляции из записи
        ВариантИзЗаписи = ДокументОбъект.ВариантКалькуляции;
        
        // 8. Используем вашу готовую функцию для получения автодеталей
//        МассивАвтодеталей = ПолучитьАвтодеталиПоВарианту(КалькуляцияОбъект, ВариантИзЗаписи);
        
    КонецЕсли;
	    
//	    СтрокаАвтодетали = ЭлементЗаписей.Калькуляция;
//	    
//	    
//	    
//	    МассивАвтодеталей = Новый Массив;
//	    // Проходим по всем строкам автодеталей в калькуляции
////	    Для Каждого СтрокаАвтодетали Из Автодетали Цикл
//	        
//        Материал = Неопределено;
//        Цена = 0;
//        Сумма = 0;
//        
//        // В зависимости от выбранного варианта берем соответствующие поля
//        Если НомерВарианта = 1 Тогда
//            Материал = СтрокаАвтодетали.Материал1;
//            Цена = СтрокаАвтодетали.Цена1;
//            Сумма = СтрокаАвтодетали.Сумма1;
//            
//        ИначеЕсли НомерВарианта = 2 Тогда
//            Материал = СтрокаАвтодетали.Материал2;
//            Цена = СтрокаАвтодетали.Цена2;
//            Сумма = СтрокаАвтодетали.Сумма2;
//            
//        ИначеЕсли НомерВарианта = 3 Тогда
//            Материал = СтрокаАвтодетали.Материал3;
//            Цена = СтрокаАвтодетали.Цена3;
//            Сумма = СтрокаАвтодетали.Сумма3;
//            
//        КонецЕсли;
//        
//        // Если материал для выбранного варианта заполнен
//        Если ЗначениеЗаполнено(Материал) Тогда
//            
//            СтруктураАвтодетали = Новый Структура();
//            
//            // Основные поля
//            СтруктураАвтодетали.Вставить("Автодеталь", СтрокаАвтодетали.Автодеталь);
//            СтруктураАвтодетали.Вставить("Количество", СтрокаАвтодетали.Количество);
//            
//            // Данные из выбранного варианта
//            СтруктураАвтодетали.Вставить("Материал", Материал);
//            СтруктураАвтодетали.Вставить("Цена", Цена);
//            СтруктураАвтодетали.Вставить("Сумма", Сумма);
//            
//            // Ссылка на работу (если есть)
//            Если ЗначениеЗаполнено(СтрокаАвтодетали.СсылкаНаРаботу) Тогда
//                СтруктураАвтодетали.Вставить("СсылкаНаРаботу", СтрокаАвтодетали.СсылкаНаРаботу);
//            КонецЕсли;
//            
//            МассивАвтодеталей.Добавить(СтруктураАвтодетали);
//            
//            Сообщить("Добавлена автодеталь: " + СтрокаАвтодетали.Автодеталь + 
//                    " -> материал: " + Материал + 
//                    ", цена: " + Цена + 
//                    ", количество: " + СтрокаАвтодетали.Количество);
//        КонецЕсли;
        
    КонецЦикла;
//	КонецЦикла;
	
КонецПроцедуры

&НаСервере
Функция НайтиЗаписиКлиентаНаСегодняНаСервере(Клиент, Автомобиль)
    
    МассивЗаписей = Новый Массив;
    
    Запрос = Новый Запрос;
    Запрос.Текст = 
    "ВЫБРАТЬ
    |    ЗаписьВСервис.Ссылка КАК Ссылка,
    |    ЗаписьВСервис.Дата,
    |    ЗаписьВСервис.Автомобиль,
    |    ЗаписьВСервис.ПричинаОбращения,
    |    ЗаписьВСервис.Калькуляция,
    |    ЗаписьВСервис.ВариантКалькуляции
    |ИЗ
    |    Документ.ЗаписьВСервис КАК ЗаписьВСервис
    |ГДЕ
    |    ЗаписьВСервис.Клиент = &Клиент
    |    И ЗаписьВСервис.Дата >= &НачалоДня
    |    И ЗаписьВСервис.Дата <= &КонецДня
    |    И ЗаписьВСервис.Автомобиль = &Автомобиль";
    
    
    Запрос.Текст = Запрос.Текст + " УПОРЯДОЧИТЬ ПО ЗаписьВСервис.Дата";
    
    Запрос.УстановитьПараметр("Клиент", Клиент);
    Запрос.УстановитьПараметр("НачалоДня", НачалоДня(ТекущаяДата()));
    Запрос.УстановитьПараметр("КонецДня", КонецДня(ТекущаяДата()));
    Запрос.УстановитьПараметр("Автомобиль", Автомобиль);
    
    Результат = Запрос.Выполнить();
    Выборка = Результат.Выбрать();
    
    Пока Выборка.Следующий() Цикл
        СтруктураЗаписи = Новый Структура;
        СтруктураЗаписи.Вставить("Ссылка", Выборка.Ссылка);
        СтруктураЗаписи.Вставить("Дата", Выборка.Дата);
        СтруктураЗаписи.Вставить("Автомобиль", Выборка.Автомобиль);
        СтруктураЗаписи.Вставить("ПричинаОбращения", Выборка.ПричинаОбращения);
        СтруктураЗаписи.Вставить("Калькуляция", Выборка.Калькуляция);
        СтруктураЗаписи.Вставить("ВариантКалькуляции", Выборка.ВариантКалькуляции);
        МассивЗаписей.Добавить(СтруктураЗаписи);
    КонецЦикла;
    
    Возврат МассивЗаписей;
    
КонецФункции

//&НаСервере
//Процедура ЗаполнитьДанныеНаСервере()
//	
//	// ываываываыва
//	// 
//	Запрос = Новый Запрос;
//	Запрос.Текст = "ВЫБРАТЬ ПЕРВЫЕ 1
//	|	Калькуляция.Ссылка КАК Ссылка
//	|ИЗ
//	|	Документ.Калькуляция КАК Калькуляция
//	|ГДЕ
//	|	Калькуляция.Клиент = &Клиент
//	|	И Калькуляция.Автомобиль = &Автомобиль
//	|	И Калькуляция.Проведен = ИСТИНА
//	|
//	|УПОРЯДОЧИТЬ ПО
//	|	Калькуляция.Дата УБЫВ
//	|	, Калькуляция.МоментВремени УБЫВ";
//	
//	Запрос.УстановитьПараметр("Клиент", Объект.Клиент);
//	Запрос.УстановитьПараметр("Автомобиль", Объект.Автомобиль);
//	
//	РезультатЗапроса = Запрос.Выполнить();
//	Выборка = РезультатЗапроса.Выбрать();
//	
//	Если Выборка.Следующий() Тогда
//		// 
//		Объект.Калькуляция = Выборка.Ссылка;
//		ЗаполнитьИзКалькуляцииНаСервере();
//	Иначе
//		// 
//		Сообщить("Калькуляция для данного клиента и автомобиля не найдена. Заполните данные вручную или создайте калькуляцию.");
//	КонецЕсли;
//	
//КонецПроцедуры

&НаКлиенте
Процедура КлиентПриИзменении(Элемент)
	
	// 
	//
	
КонецПроцедуры

&НаКлиенте
Процедура СтатусПриИзменении(Элемент)
	
	// 
	Если Объект.Статус = Неопределено Или Объект.Статус.Пустая() Тогда
		Возврат;
	КонецЕсли;
	
	//
	// 
	
КонецПроцедуры

//&НаКлиенте
//Процедура КалькуляцияПриИзменении(Элемент)
//	
//	// 
//	Если Объект.Калькуляция <> Неопределено И Не Объект.Калькуляция.Пустая() Тогда
//		ЗаполнитьИзКалькуляцииНаСервере();
//	КонецЕсли;
//	
//КонецПроцедуры

//&НаСервере
//Процедура ЗаполнитьИзКалькуляцииНаСервере()
//	
//	// 
//	Если Объект.Калькуляция = Неопределено Или Объект.Калькуляция.Пустая() Тогда
//		Возврат;
//	КонецЕсли;
//	
//	ДокументКалькуляция = Объект.Калькуляция.ПолучитьОбъект();
//	
//	//
//	Объект.Работы.Очистить();
//	Для Каждого СтрокаРаботы Из ДокументКалькуляция.Работы Цикл
//		НоваяСтрокаРаботы = Объект.Работы.Добавить();
//		НоваяСтрокаРаботы.Работа = СтрокаРаботы.Работа;
//		НоваяСтрокаРаботы.Количество = СтрокаРаботы.Количество;
//		НоваяСтрокаРаботы.НормаЧас = СтрокаРаботы.НормаЧас;
//		НоваяСтрокаРаботы.Сумма = СтрокаРаботы.НормаЧас * СтрокаРаботы.Количество;
//	КонецЦикла;
//	
//	// 
//	Объект.Автодетали.Очистить();
//	Для Каждого СтрокаДетали Из ДокументКалькуляция.Автодетали Цикл
//		НоваяСтрокаДетали = Объект.Автодетали.Добавить();
//		НоваяСтрокаДетали.Автодеталь = СтрокаДетали.Автодеталь;
//		НоваяСтрокаДетали.Количество = СтрокаДетали.Количество;
//		// 
//		НоваяСтрокаДетали.ДетальКлиента = Ложь;
//	КонецЦикла;
//	
//КонецПроцедуры

&НаКлиенте
Процедура РаботыРаботаПриИзменении(Элемент)
	
	// 
	СтрокаРаботы = Элементы.Работы.ТекущиеДанные;
	Если СтрокаРаботы = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	Если СтрокаРаботы.Работа <> Неопределено И Не СтрокаРаботы.Работа.Пустая() Тогда
		// 
		НормаЧас = ПолучитьНормаЧасРаботыНаСервере(СтрокаРаботы.Работа);
		Если НормаЧас > 0 Тогда
			СтрокаРаботы.НормаЧас = НормаЧас;
			// 
			ПересчитатьСуммуРаботы(СтрокаРаботы);
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Функция ПолучитьНормаЧасРаботы(Работа)
	
	Если Работа = Неопределено Или Работа.Пустая() Тогда
		Возврат 0;
	КонецЕсли;
	
	Попытка
		РаботаОбъект = Работа.ПолучитьОбъект();
		Если РаботаОбъект.Свойство("НормаЧас") Тогда
			Возврат РаботаОбъект.НормаЧас;
		Иначе
			Возврат 0;
		КонецЕсли;
	Исключение
		Возврат 0;
	КонецПопытки;
	
КонецФункции

&НаКлиенте
Функция ПолучитьНормаЧасРаботыНаСервере(Работа)
	
	Возврат ПолучитьНормаЧасРаботы(Работа);
	
КонецФункции

&НаКлиенте
Процедура РаботыКоличествоПриИзменении(Элемент)
	
	// 
	СтрокаРаботы = Элементы.Работы.ТекущиеДанные;
	Если СтрокаРаботы <> Неопределено Тогда
		ПересчитатьСуммуРаботы(СтрокаРаботы);
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Функция РассчитатьНормаЧасы(Работа, Количество)
	РаботаОбъект = Работа.ПолучитьОбъект();
	Возврат РаботаОбъект.НормаЧас * Количество
КонецФункции

&НаКлиенте
Процедура ПересчитатьСуммуРаботы(СтрокаРаботы)
	
	Если СтрокаРаботы = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	// 
	СтрокаРаботы.Сумма = СтрокаРаботы.НормаЧас * СтрокаРаботы.Количество;
	
КонецПроцедуры

&НаКлиенте
Процедура АвтодеталиАвтодетальПриИзменении(Элемент)
	
	// 
	
КонецПроцедуры

&НаКлиенте
Процедура АвтодеталиДетальКлиентаПриИзменении(Элемент)
	
	// 
	СтрокаДетали = Элементы.Автодетали.ТекущиеДанные;
	Если СтрокаДетали = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	Если СтрокаДетали.ДетальКлиента Тогда
		//
		СтрокаДетали.Автодеталь = Неопределено;
		СтрокаДетали.Материал = Неопределено;
		СтрокаДетали.Цена = 0;
		СтрокаДетали.Сумма = 0;
	Иначе
		// 
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура АвтодеталиМатериалПриИзменении(Элемент)
	
	// 
	СтрокаДетали = Элементы.Автодетали.ТекущиеДанные;
	Если СтрокаДетали = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	// 
	Если СтрокаДетали.ДетальКлиента Тогда
		СтрокаДетали.Цена = 0;
		СтрокаДетали.Сумма = 0;
		Возврат;
	КонецЕсли;
	
	Если СтрокаДетали.Материал <> Неопределено И Не СтрокаДетали.Материал.Пустая() Тогда
		// 
		Цена = ПолучитьЦенуМатериалаНаСервере(СтрокаДетали.Материал);
		Если Цена > 0 Тогда
			СтрокаДетали.Цена = Цена;
			ПересчитатьСуммуДетали(СтрокаДетали);
		Иначе
			СтрокаДетали.Цена = 0;
			СтрокаДетали.Сумма = 0;
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Функция ПолучитьЦенуМатериала(Материал)
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	|	СтоимостьМатериалов.Материал,
	|	СтоимостьМатериалов.Стоимость
	|ИЗ
	|	РегистрСведений.СтоимостьМатериалов КАК СтоимостьМатериалов
	|ГДЕ
    |   СтоимостьМатериалов.Материал = &Материал";
    Запрос.УстановитьПараметр(
        "Материал", Материал    
    );
    РезультатЗапроса = Запрос.Выполнить();
    Записи = РезультатЗапроса.Выбрать();
    Пока Записи.Следующий() Цикл
        Возврат Записи.Стоимость;
    КонецЦикла;
КонецФункции

&НаКлиенте
Функция ПолучитьЦенуМатериалаНаСервере(Материал)
	
	Возврат ПолучитьЦенуМатериала(Материал);
	
КонецФункции

&НаКлиенте
Процедура АвтодеталиКоличествоПриИзменении(Элемент)
	
	// 
	СтрокаДетали = Элементы.Автодетали.ТекущиеДанные;
	Если СтрокаДетали <> Неопределено Тогда
		// 
		Если СтрокаДетали.ДетальКлиента Тогда
			СтрокаДетали.Сумма = 0;
		Иначе
			ПересчитатьСуммуДетали(СтрокаДетали);
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура АвтодеталиЦенаПриИзменении(Элемент)
	
	// 
	СтрокаДетали = Элементы.Автодетали.ТекущиеДанные;
	Если СтрокаДетали <> Неопределено Тогда
		//
		Если СтрокаДетали.ДетальКлиента Тогда
			СтрокаДетали.Сумма = 0;
		Иначе
			ПересчитатьСуммуДетали(СтрокаДетали);
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПересчитатьСуммуДетали(СтрокаДетали)
	
	Если СтрокаДетали = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	//
	Если СтрокаДетали.ДетальКлиента Тогда
		СтрокаДетали.Сумма = 0;
		Возврат;
	КонецЕсли;
	
	// 
	СтрокаДетали.Сумма = СтрокаДетали.Цена * СтрокаДетали.Количество;
	
КонецПроцедуры